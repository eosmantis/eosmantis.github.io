<html>
<head>
<link rel="icon" href="img/icon.png" />
<link rel="stylesheet" href="css/style.css?ttd=445644" />

 <!-- BEGINN WALLET-INCLUDE-->
    
    <!-- Anchor js -->
    <script src="https://unpkg.com/anchor-link@next"></script>
    <script src="https://unpkg.com/anchor-link-browser-transport@next"></script>
        
    <!-- Scatter js -->
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.9/lib/eos.min.js"></script>  

    <script src="js/bundles/scatterjs-core.min.js"></script>
    <script src="js/bundles/scatterjs-plugin-eosjs.min.js"></script>
    <script src="js/bundles/scatterjs-plugin-lynx.min.js"></script>    
    
    <script src="js/eosiowallet/wallet.js?dsd=79524"></script>   
    
    <script src="js/eosjs-account-name_2.2.1.js"></script>  
   
 
              
 <!-- END WALLET-INCLUDE-->



</head>

<body class='bodyclass' style='background: url("img/backblue.png")'>
 
  <div id='logo1' class='logo1x' style='text-align:center;'>
  <img src='img/logo.svg?t=d453s' style='margin-top:30px;height:60px;'><br>
  SOVDEX II<br>
  <br>
  </div>

 <div id='' style='position:absolute;top:30px;right:50px;border:none;cursor:pointer;'> 
 <img src='img/powerup.svg?t=d453s' alt='PowerUp' title='PowerUp' onclick='powerup(0.01)' style='height:60px;width:60px;'>  
 </div>


<!-- walletmenu -->

<div id='walletmenu' class='walletmenu' style='border:width:100%;height:90px;'>

<div id='walletmenu_left' style='float:left;position:relative;width:49%;text-align:center;margin-top:20px;background:#55ff55;'>


 <div id='walletmenu_accountname' style='position:absolute;width:100%;top:0px;'>
 
 <div id='myaccountname' class='myaccountname' style='font-size:2em;color:#ffffff;font-weight:bold;'>...abc</div>
 
 </div>
 
 <div id='walletmenu_anchor' style='position:absolute;width:100%;'>
 <div id='anchorbutton' onclick="login_anchor()" class='loginbutton_anchor noselect' style='margin-left:auto;margin-right:auto;' >ANCHOR</div> 
 
 </div>

 
</div>





<div id='walletmenu_right' style='float:left;position:relative;width:49%;text-align:center;margin-top:20px;background:#5555ff;'>
  <div id='walletmenu_aa' style='position:absolute;width:100%;'>
  <div id='logoutbutton' onclick="logout_all()"  class='defaultbutton noselect' style='visibility:hidden;margin-left:auto;margin-right:auto;' >Logout</div>

  </div>

  <div id='walletmenu_scatter' style='position:absolute;width:100%;visibility:hiddenx;'>
 <div onclick="login_scatter()" class='defaultbutton noselect' style='margin-left:auto;margin-right:auto;'  >SCATTER/TP/WOMBAT</div>

  </div>

</div>


<div style='clear:both;'></div>




</div> <!-- end walletmenu -->

<div id='menu' style='width:margin-left:auto;margin-right:auto;padding:5px;'>
<a href='index.html' style='color:#ffffff;text-decoration:none;'>START</a> | <a href='faucet.html' style='color:#ffffff;text-decoration:none;'>FAUCET</a>  
</div>

<br>
<br>

 
<div id='menu' style='margin-left:5%;'>
<small>ALL THIS HERE IS EXPERIMENTAL!!! </small>
</div>


<div class='separator'>&nbsp;</div>

<br>
<div id='' onclick='readpairs()' class='swapbutton' style='margin-left:5%;text-align:center;width:100px;'> Markets </div>



<div style='clear:both;'></div>
 
 
<div id='divcenter' style='text-align:center;'> 


<!--
<div id='' style='text-align:center'>SVX balance</div>
<div id='svxbalance' style='text-align:center;font-size:40px;'>...</div>
-->

 

</div> <!-- divcenter -->

<div style='clear:both;'></div>
 
<br>
<br>



<div id='swapdiv' style='text-align:center;'></div>

<div id='pairdivs' style='text-align:center;'> ... </div>
<br>
<br>



<div id='debug' style='text-align:center;'></div>
<br>
<br>
<br>
<br>
 
 
<br>
<br>
<div style='float:right;margin-left:30px;font-size:12px;'>frontend V0.1e</div>
 


<script>
var id = 10;
var tokenid = 12;
var price = 1;
var user = "sovdex"
  var row2 = { 0:id,1:tokenid,2:price,3:user,4:1.3,5:6 };
      
   
       console.log("row:");
       console.log(row2);
 
 
function setaccountname( name )
{
document.getElementById('myaccountname').innerHTML = ""+name+"";
 
document.getElementById('walletmenu_anchor').style.visibility = "hidden";
document.getElementById('walletmenu_anchor').style.height = "0px";

document.getElementById('walletmenu_scatter').style.visibility = "hidden";
document.getElementById('walletmenu_scatter').style.height = "0px"; 

document.getElementById('logoutbutton').style.visibility = "visible";
document.getElementById('logoutbutton').style.height = ""; 
}



function logoutall( name )
{
document.getElementById('myaccountname').innerHTML = "xxx";

document.getElementById('walletmenu_anchor').style.visibility = "visible";
document.getElementById('walletmenu_anchor').style.height = "";

document.getElementById('walletmenu_scatter').style.visibility = "visible";
document.getElementById('walletmenu_scatter').style.height = "";

 
document.getElementById('logoutbutton').style.visibility = "hidden";
document.getElementById('logoutbutton').style.height = "0px";
}



function external_login_action()
{
update_counter = 0;
}

function func_success( message )
{
alert(message);
}

function func_error( message )
{
alert(message);
}


function testtransaction()
{

var theactions = [];

memo = "This is it";


    
   
    var action = {
                 account: "eosio.token",
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "testtesttest",
                       "quantity": "0.0001 EOS",
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
   

 
 
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }
   
}


 
 
 




 

 






var first_sov_supply = "";
var sovburneddiff    = "";
// 
function callback_render_sovsupply( value )
{

console.log("value sovsupply");
console.log(value);

 
if (value.rows.length == 0) return;                   



supply = value.rows[0].supply;
 

// Calc diff
var supply2 = supply.replace("SOV", "");
supply2 = parseFloat (supply2);
   
sovburneddiff = first_sov_supply - supply2 ;
if (sovburneddiff <= 0) sovburneddiff = 0;

sovburneddiff = Number(sovburneddiff).toFixed(4);

 
 

buffer = sovburneddiff;
document.getElementById('sovburn').innerHTML = buffer + " SOV";

if ( first_sov_supply == "" )
   {   
   supply = supply.replace("SOV", "");
   supply = parseFloat (supply);
   first_sov_supply = supply;
   }
                              
} // callback_render_sovsupply



function getsovsupply()
{
getdata(callback_render_sovsupply, "sovmintofeos", "SOV", "stat", "", "", "", 112 );
}



/*
function callback_render_svxbalance( value )
{
console.log("value callback_render_svxbalance");
console.log(value);

 
if (value.rows.length == 0) return;                   

balance = value.rows[0].balance;
  
  
if (balance != undefined)
   {
   document.getElementById('svxbalance').innerHTML = balance + "";
   
    
   balance2 = balance.replace("SOV", "");
   balance2 = parseFloat (balance); 
   
   }
                              
} // callback_render_sovsupply



function getsvxbalance2()
{
getdata(callback_render_svxbalance, "svxmintofeos", global_account, "accounts", "", "", "", 112 );
}

*/

function powerup( eosforpower )
{

//eosforpower = document.getElementById("eosforpower").value;
 
var theactions = [];

      

eosforpower = Number(eosforpower).toFixed(4) + " EOS";   

    
   
var memo = global_account+"";
 
   
  
//var quantityeos = globaldata['a_sov'] / 10000;
//quantitysov = Number(quantitysov).toFixed(4) + " SOV";   
   

 
   
    var action = {
                 account: "eosio.token",
                 name: 'transfer',
                 authorization: [{
                                actor: global_account,
                                permission: "active"
                                }],
                 data: {
                       "from": global_account,
                       "to": "powerupcalc1",
                       "quantity": eosforpower,
                       "memo": memo,
                        
                      
                       }
                 };



 
    theactions.push(action);
   

 
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }
   
   
} // powerup



var cnt = 0;
function update_thread()
{
console.log("THREAD");

//getsovsupply();


//if ( (cnt % 2) == 0 ) getsvxbalance2();
/*
if ( (cnt % 2) == 0 ) getsvxbalance2();

if ( (cnt % 4) == 0 ) getbalancedata();

if ( (cnt % 6) == 0 ) getsovbalancedata();
*/

 
console.log("first_sov_supply: " );
console.log(first_sov_supply);

console.log("sovburneddiff: " );
console.log(sovburneddiff);

cnt++; 
var time = setTimeout("update_thread()", 3000);
  
} //// update_thread


 
function getLastPart(inputString) {
    // Zuerst splitten wir den Eingabestring anhand von Leerzeichen
    const parts = inputString.split(' ');
    // Der letzte Teilstring ist dann das letzte Element des Arrays
    const lastPart = parts[parts.length - 1];
    // RÃ¼ckgabe des letzten Teilstrings
    return lastPart;
} 
 
 
 

function callback_render_loadpairs( value )
{

if (value.rows.length == 0) return;   

buffer = "";

buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Markets</h3>";
buffer += "</div>";


size = value.rows.length;
console.log("--- size: ",size);
console.log( value );
// buffer += "size: " + size;

 /*

// sort array
var thearray = new Array();

for (var i=0; i<size; i++)
    {
    thearray[i] = new Object();
    thearray[i]['index'] = i;
    thearray[i]['order'] = value.rows[i].order;    
    } // for i..size


console.log("PRE");
console.log( thearray );

// sort

var SORT = 1;
while (SORT == 1)
{
SORT = 0;

for (var i=0; i<size-1; i++)
    {
//    thearray[i] = new Object();

    if ( thearray[i]['order'] > thearray[i+1]['order'] )
       {
       o_index = thearray[i]['index'];
       o_order = thearray[i]['order'];    

       thearray[i]['index'] = thearray[i+1]['index'];
       thearray[i]['order'] = thearray[i+1]['order'];
    
       thearray[i+1]['index'] = o_index;
       thearray[i+1]['order'] = o_order;
       SORT = 1;
       } // 
       
    } // for i..size
    
} // while (SORT)

console.log("AFTER");
console.log( thearray );

*/

for (var i=0; i<size; i++)
    {
    pair_id              = value.rows[i].id;
    token1               = value.rows[i].token1;
    token2               = value.rows[i].token2;
    
    tokensym1 = getLastPart(token1);
    tokensym2 = getLastPart(token2);
    
    token_contract1      = value.rows[i].token_contract1;
    token_contract2      = value.rows[i].token_contract2;

   /*
    var i2 = thearray[i]['index'];
    
    payout       = value.rows[i2].payout;
    contract     = value.rows[i2].contract;
    description  = value.rows[i2].description;
    noderequired = value.rows[i2].noderequired;
    
     */
 
    buffer += "<div  class='paircell' style=''> " ;
    buffer += "<div    style='height:10px;'></div> " ;

    buffer += "<div  class='paircell_inner' style='text-align:left;'> " ;

       buffer += "<div  class='' style='float:left;width:100px;margin-left:20px;'>" ;
       buffer += "<span style='font-weight:bold;'>"+tokensym1+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+token_contract1+"</span><br>" ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:20px;font-size:30px;border:none'>" ;
       buffer += " / " ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:100px;;border:none'>" ;
       buffer += "<span style='font-weight:bold;'>"+tokensym2+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+token_contract2+"</span><br>" ;
       buffer += "</div> " ;
       
       
        buffer += "<div  class='' style='float:left;width:450px;margin-left:30px;font-size:16px;text-align:left;;border:none'>" ;
       buffer += "Depth<br>";
       buffer +=""+token1+  " / "+token2+" " ;
       buffer += "</div> " ;





       buffer += "<div  class='' style='float:right;width:100px;margin-top:10px;border:none;'>" ;
       buffer += "<span class='swapbutton' onclick='openswap("+pair_id+")'>  SWAP  </span>" ;

       buffer += "</div> " ;


       buffer += "<div style='clear:both;'></div> " ;
    
    
    
 
  //  buffer += "<span onclick='openswap("+pair_id+")'> [ SWAP ] </span>" ;
    buffer += "</div> " ;
          
    buffer += "<div style='clear:both;'></div> " ;
          
          
    buffer += "</div> " ;
    buffer += "<br> " ;
    } // for i...
 


document.getElementById('pairdivs').innerHTML = buffer;
document.getElementById('swapdiv').innerHTML = "";
                         
                               
} // callback_render_loadpairs


 
 
 
var swapdirection              = 1;    
var global_pair_id             = 1;   
var global_token1              = "";
var global_token2              = "";
var global_tokensym1           = "";
var global_tokensym2           = "";
var global_token_contract1     = "";
var global_token_contract2     = "";




function render_swap_area()
{

buffer = "";


/*


*/
buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>SWAP</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";




//buffer += "token id " + global_pair_id + " " + swapdirection;


if (swapdirection == 1)
{


 
buffer += "<div id='tokenbalance1' style='float:right;'>Balance: xxx</div><br>";
buffer += "Payment:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<input id='tokenamount1' type='text' placeholder='Please enter amount' value=''> <br>";

buffer += "<br>";

 // alf
buffer += "<div id='swaparrow' class='swaparrow' onclick='switchswapdir()'>&#8595;</div>";

 
// &#8595; &#8593;  swaparrow
buffer += "<br>";

 
buffer += "<div id='tokenbalance2' style='float:right;'>Balance: yyy</div><br>";
buffer += "Received:<br>";
buffer += global_tokensym2+"<br>";
buffer += global_token_contract2+"<br>";
buffer += "<input id='tokenamount2' type='text'  placeholder='Please enter amount' value='' > <br>";

buffer += "<br>";




 
buffer += "<div id='swapaction' onclick='swapaction("+global_pair_id+",\""+token_contract1+"\")' class='swapbutton' style='text-align:center;width:100px;' > SWAP </div>";


} // if (swapdirection == 1)




if (swapdirection == 2)
{


 
buffer += "<div id='tokenbalance2' style='float:right;'>Balance: ...</div><br>";
buffer += "Payment:<br>";
buffer += global_tokensym2+"<br>";
buffer += global_token_contract2+"<br>";
buffer += "<input id='tokenamount2' type='text' placeholder='Please enter amount' value=''> <br>";

buffer += "<br>";

buffer += "<div id='swaparrow' class='swaparrow' onclick='switchswapdir()'>&#8593;</div>";


buffer += "<br>";

 
buffer += "<div id='tokenbalance1' style='float:right;'>Balance: ...</div><br>";
buffer += "Received:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<input id='tokenamount1' type='text'  placeholder='Please enter amount' value='' > <br>";

buffer += "<br>";



buffer += "<div id='swapaction' onclick='swapaction("+global_pair_id+",\""+token_contract1+"\")' class='swapbutton' style='text-align:center;width:100px;' > SWAP </div>";


} // if (swapdirection == 1)


/*


*/


buffer += "</div>";
buffer += "<br>";
buffer += "</div>";

 



document.getElementById('pairdivs').innerHTML = "";
document.getElementById('swapdiv').innerHTML  = buffer;

 
get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
 

} // render_swap_area



function callback_render_loadsinglepair( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";

/*
token_contract1	
token2	
token_contract2	
lptoken	
cw	
fee_pool	
admin_pool	
fee	
fee_share	
price1	
price2	
kfactor	
total_token1_vol	
total_token2_vol	
*/

i = 0;



global_pair_id            = value.rows[i].id;
global_token1             = value.rows[i].token1;
global_token2             = value.rows[i].token2;
    
global_tokensym1          = getLastPart(global_token1);
global_tokensym2          = getLastPart(global_token2);
    
global_token_contract1    = value.rows[i].token_contract1;
global_token_contract2    = value.rows[i].token_contract2;


//alert( global_pair_id + ' ' + global_tokensym1 + ' ' + global_tokensym2);

render_swap_area();


/*
var global_token1       = "";
var global_token2       = "";
var tokensym1           = "";
var tokensym2           = "";
var token_contract1     = "";
var token_contract2     = "";
*/

// --- 


} // callback_render_loadsinglepair




/*
balance = value.rows[0].balance;
 
buffer = "" + balance;
last_balance1 = balance;
document.getElementById('balance1').innerHTML = buffer;
                               
} // callback_render_balance1



function getbalancedata()
{
getdata(callback_render_balance1, "eosio.token", global_account, "accounts", "", "", "", 112 );
}

*/

function callback_render_tokenbalance1( value )
{

if (value.rows.length == 0) return;   

balance = value.rows[0].balance;
 
document.getElementById('tokenbalance1').innerHTML = "" + balance;

console.log( value );
} // callback_render_tokenbalance1

function get_token_balance1(token1, token_contract1)
{
getdata(callback_render_tokenbalance1, token_contract1, global_account, "accounts", "", "", "", 112 );

} // get_token_balance1




function callback_render_tokenbalance2( value )
{

if (value.rows.length == 0) return;   

balance = value.rows[0].balance;
 
document.getElementById('tokenbalance2').innerHTML = "" + balance;

console.log( value );
} // callback_render_tokenbalance2

function get_token_balance2(token2, token_contract2)
{
getdata(callback_render_tokenbalance2, token_contract2, global_account, "accounts", "", "", "", 112 );

} // get_token_balance2



function openswap( tokenid )
{
//alert("Token ID " + tokenid); 

// getdata2(callback_readasset_forlist, params, "atomicassets", "sovspacegame", "assets", asset_id, "", "", 1 );

getdata(callback_render_loadsinglepair, "sovdex2trade", "sovdex2trade", "relays", tokenid, "", "", 1 );

/*

*/
} // openswap
 
 
function readpairs()
{
//alert('read pairs');

getdata(callback_render_loadpairs, "sovdex2trade", "sovdex2trade", "relays", "", "", "", 4000 );

//document.getElementById('pairdivs').innerHTML = "abc";
  
//pairdivs

} // readpairs


// alfalf
function swapaction( pair_id, token_contract1)
{

// swapdirection

tokenamount1 = document.getElementById('tokenamount1').value; 
tokenamount2 = document.getElementById('tokenamount2').value; 


// alfalf
tokenamount1 = Number(tokenamount1).toFixed(4) + " " + global_tokensym1;   
tokenamount2 = Number(tokenamount2).toFixed(4) + " " + global_tokensym2;   


//alert( pair_id  + ' ' + tokenamount1 + ' ' + token_contract1 + ' ' + global_account );



var theactions = [];


if (swapdirection == 1)
{

memo = "";




    
    
    
   
    var action = {
                 account: global_token_contract1,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount1,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    
    

   
    var action = {
                 account: "sovdex2trade",
                 name: 'swap',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "swapasset": tokenamount1,
                       "relay_id": pair_id,
                       "receiver": global_account + "",
                       "intermediate": false,
                       "expected": tokenamount2,
                       "tolerance": 500 
                       }
                 };

 
    theactions.push(action);
    
    
    
        
    
    console.log("----- " + global_account);
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   
   
} // if (swapdirection == 1)


   
   


if (swapdirection == 2)
{

memo = "";



//alert(" Other dir ");
    
  
    
   
    var action = {
                 account: global_token_contract2,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount2,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    
    

   
    var action = {
                 account: "sovdex2trade",
                 name: 'swap',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "swapasset": tokenamount2,
                       "relay_id": pair_id,
                       "receiver": global_account + "",
                       "intermediate": false,
                       "expected": tokenamount1,
                       "tolerance": 500 
                       }
                 };

 
    theactions.push(action);
    
    
    
        
    
    console.log("----- " + global_account);
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
 
   
} // if (swapdirection == 1)

   
 
} // swapaction


function switchswapdir( dir )
{
//alert(dir);

// &#8595; &#8593;  swaparrow

if (swapdirection == 1) 
   {
   swapdirection = 2; 
   
   }
   else
      {
      swapdirection = 1;

      }


render_swap_area();

} // switchswapdir



readpairs();

</script>


<script>
init_wallets( "sovpowerpack",setaccountname, logoutall );

update_thread(); 
</script>

</body>
</hmtl>