<html>
<head>
<link rel="icon" href="img/icon.png" />
<link rel="stylesheet" href="css/style.css?ttd=445644" />

 <!-- BEGINN WALLET-INCLUDE-->
    
    <!-- Anchor js -->
    <script src="https://unpkg.com/anchor-link@next"></script>
    <script src="https://unpkg.com/anchor-link-browser-transport@next"></script>
        
    <!-- Scatter js -->
    <script src="https://cdn.jsdelivr.net/npm/eosjs@16.0.9/lib/eos.min.js"></script>  

    <script src="js/bundles/scatterjs-core.min.js"></script>
    <script src="js/bundles/scatterjs-plugin-eosjs.min.js"></script>
    <script src="js/bundles/scatterjs-plugin-lynx.min.js"></script>    
    
    <script src="js/eosiowallet/wallet.js?dsd=79524"></script>   
    
    <script src="js/eosjs-account-name_2.2.1.js"></script>  
   
 
              
 <!-- END WALLET-INCLUDE-->

    <!-- Decimal -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/decimal.js/10.3.1/decimal.min.js"></script>


</head>

<body class='bodyclass' style='background: url("img/backblue.png")'>
 
  <div id='logo1' class='logo1x' style='text-align:center;'>
  <img src='img/logo.svg?t=d453s' style='margin-top:30px;height:60px;'><br>
  SOVDEX II<br>
  <br>
  </div>

 <div id='' style='position:absolute;top:30px;right:50px;border:none;cursor:pointer;'> 
 <img src='img/powerup.svg?t=d453s' alt='PowerUp' title='PowerUp' onclick='powerup(0.01)' style='height:60px;width:60px;'>  
 </div>


<!-- walletmenu -->

<div id='walletmenu' class='walletmenu' style='border:width:100%;height:90px;'>

<div id='walletmenu_left' style='float:left;position:relative;width:49%;text-align:center;margin-top:20px;background:#55ff55;'>


 <div id='walletmenu_accountname' style='position:absolute;width:100%;top:0px;'>
 
 <div id='myaccountname' class='myaccountname' style='font-size:2em;color:#ffffff;font-weight:bold;'>...abc</div>
 
 </div>
 
 <div id='walletmenu_anchor' style='position:absolute;width:100%;'>
 <div id='anchorbutton' onclick="login_anchor()" class='loginbutton_anchor noselect' style='margin-left:auto;margin-right:auto;' >ANCHOR</div> 
 
 </div>

 
</div>





<div id='walletmenu_right' style='float:left;position:relative;width:49%;text-align:center;margin-top:20px;background:#5555ff;'>
  <div id='walletmenu_aa' style='position:absolute;width:100%;'>
  <div id='logoutbutton' onclick="logout_all()"  class='defaultbutton noselect' style='visibility:hidden;margin-left:auto;margin-right:auto;' >Logout</div>

  </div>

  <div id='walletmenu_scatter' style='position:absolute;width:100%;visibility:hiddenx;'>
 <div onclick="login_scatter()" class='defaultbutton noselect' style='margin-left:auto;margin-right:auto;'  >SCATTER/TP/WOMBAT</div>

  </div>

</div>


<div style='clear:both;'></div>




</div> <!-- end walletmenu -->

<div id='menu' style='width:margin-left:auto;margin-right:auto;padding:5px;'>
<a href='https://eosmantis.github.io/sovpowerpack/index.html' style='color:#ffffff;text-decoration:none;'>START</a> | <a href='https://eosmantis.github.io/sovpowerpack/faucet.html' style='color:#ffffff;text-decoration:none;'>FAUCET</a>  
</div>

<br>
<br>

 
<div id='menu' style='margin-left:5%;'>
<small>EVERYTHING HERE IS EXPERIMENTAL!!! </small>
</div>


<div class='separator'>&nbsp;</div>

<br>
<div id='' onclick='readpairs()' class='swapbutton' style='margin-left:5%;text-align:center;width:100px;float:left;margin-left:5%;'> Markets </div>
<div id='' onclick='createpair()' class='swapbutton' style='margin-left:5%;text-align:center;width:200px;float:left;margin-left:10px;'> Create Market </div>
<div id='' onclick='showpools()' class='swapbutton' style='margin-left:5%;text-align:center;width:100px;float:left;margin-left:10px;'> Pools </div>

<!--
<div id='' onclick='showfarms()' class='swapbutton' style='margin-left:5%;text-align:center;width:100px;float:left;margin-left:10px;'> Farm </div>
-->


<div style='clear:both;'></div>
 
 
<div id='divcenter' style='text-align:center;'> 


<!--
<div id='' style='text-align:center'>SVX balance</div>
<div id='svxbalance' style='text-align:center;font-size:40px;'>...</div>
-->

 

</div> <!-- divcenter -->

<div style='clear:both;'></div>
 
<br>
<br>


<div id='liquiditydiv' style='text-align:center;'></div>

<div id='createmarketdiv' style='text-align:center;'></div>

<div id='swapdiv' style='text-align:center;'></div>

<div id='minediv' style='text-align:center;'></div>

<div id='pairdivs' style='text-align:center;'></div>

<div id='pooldivs' style='text-align:center;'></div>

<div id='rewarddiv' style='text-align:center;'></div>

<div id='votediv' style='text-align:center;'></div>


<br>
<br>



<div id='debug' style='text-align:center;'></div>
<br>
<br>
<br>
<br>
 
 
<br>
<br>
<div style='float:right;margin-right:5%;margin-bottom:20px;font-size:12px;'>frontend V0.1f</div>
 


<script>
var id = 10;
var tokenid = 12;
var price = 1;
var user = "sovdex"
  var row2 = { 0:id,1:tokenid,2:price,3:user,4:1.3,5:6 };
      
   
       console.log("row:");
       console.log(row2);
 
 
function setaccountname( name )
{
document.getElementById('myaccountname').innerHTML = ""+name+"";
 
document.getElementById('walletmenu_anchor').style.visibility = "hidden";
document.getElementById('walletmenu_anchor').style.height = "0px";

document.getElementById('walletmenu_scatter').style.visibility = "hidden";
document.getElementById('walletmenu_scatter').style.height = "0px"; 

document.getElementById('logoutbutton').style.visibility = "visible";
document.getElementById('logoutbutton').style.height = ""; 
}



function logoutall( name )
{
document.getElementById('myaccountname').innerHTML = "xxx";

document.getElementById('walletmenu_anchor').style.visibility = "visible";
document.getElementById('walletmenu_anchor').style.height = "";

document.getElementById('walletmenu_scatter').style.visibility = "visible";
document.getElementById('walletmenu_scatter').style.height = "";

 
document.getElementById('logoutbutton').style.visibility = "hidden";
document.getElementById('logoutbutton').style.height = "0px";
}



function external_login_action()
{
update_counter = 0;
}

function func_success( message )
{

get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
get_token_balance_lp(lptoken, "sovdex2trade");
 
alert(message);
}


function func_success_vote( message )
{
/*
get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
get_token_balance_lp(lptoken, "sovdex2trade");
 */
//alert('vote global_pair_id:'+global_pair_id);
alert(message);

initvoteload(global_pair_id);
}


function func_success_unvote( message )
{
/*
get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
get_token_balance_lp(lptoken, "sovdex2trade");
 */
//alert('vote global_pair_id:'+global_pair_id);
alert(message);

initunvoteload(global_pair_id);
}


function func_error( message )
{

get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
get_token_balance_lp(lptoken, "sovdex2trade");
 
alert(message);
}


function testtransaction()
{

var theactions = [];

memo = "This is it";


    
   
    var action = {
                 account: "eosio.token",
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "testtesttest",
                       "quantity": "0.0001 EOS",
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
   

 
 
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }
   
}


 
 
 




 

 






var first_sov_supply = "";
var sovburneddiff    = "";
// 
function callback_render_sovsupply( value )
{

console.log("value sovsupply");
console.log(value);

 
if (value.rows.length == 0) return;                   



supply = value.rows[0].supply;
 

// Calc diff
var supply2 = supply.replace("SOV", "");
supply2 = parseFloat (supply2);
   
sovburneddiff = first_sov_supply - supply2 ;
if (sovburneddiff <= 0) sovburneddiff = 0;

sovburneddiff = Number(sovburneddiff).toFixed(4);

 
 

buffer = sovburneddiff;
document.getElementById('sovburn').innerHTML = buffer + " SOV";

if ( first_sov_supply == "" )
   {   
   supply = supply.replace("SOV", "");
   supply = parseFloat (supply);
   first_sov_supply = supply;
   }
                              
} // callback_render_sovsupply



function getsovsupply()
{
getdata(callback_render_sovsupply, "sovmintofeos", "SOV", "stat", "", "", "", 112 );
}



/*
function callback_render_svxbalance( value )
{
console.log("value callback_render_svxbalance");
console.log(value);

 
if (value.rows.length == 0) return;                   

balance = value.rows[0].balance;
  
  
if (balance != undefined)
   {
   document.getElementById('svxbalance').innerHTML = balance + "";
   
    
   balance2 = balance.replace("SOV", "");
   balance2 = parseFloat (balance); 
   
   }
                              
} // callback_render_sovsupply



function getsvxbalance2()
{
getdata(callback_render_svxbalance, "svxmintofeos", global_account, "accounts", "", "", "", 112 );
}

*/


function callback_render_minigbalance( value )
{
//console.log("BALENCE MINING!!!!!!!");

console.log(value);

 
if (value.rows.length == 0) return;                   



balance = value.rows[0].balance;
 
 
if (balance != undefined)
   {
   document.getElementById('minebalance').innerHTML = balance + "";
   }
    
 
 
 
} // callback_render_minigbalance


function powerup( eosforpower )
{

if (eosforpower == 0)
   eosforpower = document.getElementById("eosforpower").value;
 
var theactions = [];

      

eosforpower = Number(eosforpower).toFixed(4) + " EOS";   

    
   
var memo = global_account+"";
 
   
  
//var quantityeos = globaldata['a_sov'] / 10000;
//quantitysov = Number(quantitysov).toFixed(4) + " SOV";   
   

 
   
    var action = {
                 account: "eosio.token",
                 name: 'transfer',
                 authorization: [{
                                actor: global_account,
                                permission: "active"
                                }],
                 data: {
                       "from": global_account,
                       "to": "powerupcalc1",
                       "quantity": eosforpower,
                       "memo": memo,
                        
                      
                       }
                 };



 
    theactions.push(action);
   

 
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }
   
   
} // powerup






var cnt = 0;
function update_thread()
{
console.log("THREAD");

//getsovsupply();



if (mininigdialog == 1)
   {
   
   
   getbalance_eos();
   
   //console.log("---- Balance: " + minetoken + " global_token_contract_mine:" + global_token_contract_mine );
   
    
   getdata(callback_render_minigbalance, global_token_contract_mine, global_account, "accounts", "", "", "", 112 );
 
  
   } else
     {
      
     } 


//if ( (cnt % 2) == 0 ) getsvxbalance2();
/*
if ( (cnt % 2) == 0 ) getsvxbalance2();

if ( (cnt % 4) == 0 ) getbalancedata();

if ( (cnt % 6) == 0 ) getsovbalancedata();
*/

 
console.log("first_sov_supply: " );
console.log(first_sov_supply);

console.log("sovburneddiff: " );
console.log(sovburneddiff);

cnt++; 
var time = setTimeout("update_thread()", 3000);
  
} //// update_thread




function getbalance_eos()
{
//alert("test getdata");

getaccount(global_account).then(function(value) {
             
               var cpu_available = value.cpu_limit.available;

                                var cpu_max = value.cpu_limit.max;

                                var cpu_used = value.cpu_limit.used;

                                var net_max = value.net_limit.max;

                                var net_used = value.net_limit.used;

                                var balance = value.core_liquid_balance;
console.log("BBBB:" + balance);
                                var balance1 = value.core_liquid_balance;

                                var balance2 = value.core_liquid_balance;

                                var cpu_proz = (cpu_used / cpu_max) * 100;
                                cpu_proz = Number(cpu_proz).toFixed(1);

                                var net_proz = (net_used / net_max) * 100;
                                net_proz = Number(net_proz).toFixed(1);
                                
                             
                             //   document.getElementById('balance_eos').innerHTML = balance;


  if (document.getElementById('minecpu')) {
                                    cpu_proz = Number(cpu_proz).toFixed(0) * 1;
                                    
                                     
                             document.getElementById('minecpu').innerHTML =  ""+ cpu_proz + "% ";  
                             
                             
                             const svg = drawCircularSegment( cpu_proz * 3.6);
                             if ( document.getElementById('svgsegmentcpu') )
                                document.getElementById('svgsegmentcpu').innerHTML = ""+svg+"";

     
                                  //  set_circle_element("mycpu", cpu_proz);
                                }
                                
  if (document.getElementById('div_net')) {
                                    net_proz = Number(net_proz).toFixed(0) * 1;
                                    document.getElementById('div_net').innerHTML = ""+ net_proz + "% NET&nbsp;&nbsp;&nbsp;&nbsp;";
                                  //  set_circle_element("mycpu", cpu_proz);
                                }                                
 

             }  );


//getdata(callback_render_balance_eos, "eosio.token", global_account, "accounts", "", "", "", 1 );
} // getbalance_eos


 
function getLastPart(inputString) {
    // Zuerst splitten wir den Eingabestring anhand von Leerzeichen
    const parts = inputString.split(' ');
    // Der letzte Teilstring ist dann das letzte Element des Arrays
    const lastPart = parts[parts.length - 1];
    // Rückgabe des letzten Teilstrings
    return lastPart;
} 
 
 
 
var global_pairs = null;


function callback_render_loadpairs( value )
{

if (value.rows.length == 0) return;   

global_pairs = value;

buffer = "";

buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Markets</h3>";
buffer += "</div>";


size = value.rows.length;
console.log("--- size: ",size);
console.log( value );
// buffer += "size: " + size;

 /*

// sort array
var thearray = new Array();

for (var i=0; i<size; i++)
    {
    thearray[i] = new Object();
    thearray[i]['index'] = i;
    thearray[i]['order'] = value.rows[i].order;    
    } // for i..size


console.log("PRE");
console.log( thearray );

// sort

var SORT = 1;
while (SORT == 1)
{
SORT = 0;

for (var i=0; i<size-1; i++)
    {
//    thearray[i] = new Object();

    if ( thearray[i]['order'] > thearray[i+1]['order'] )
       {
       o_index = thearray[i]['index'];
       o_order = thearray[i]['order'];    

       thearray[i]['index'] = thearray[i+1]['index'];
       thearray[i]['order'] = thearray[i+1]['order'];
    
       thearray[i+1]['index'] = o_index;
       thearray[i+1]['order'] = o_order;
       SORT = 1;
       } // 
       
    } // for i..size
    
} // while (SORT)

console.log("AFTER");
console.log( thearray );

*/

for (var i=0; i<size; i++)
    {
    pair_id              = value.rows[i].id;
    token1               = value.rows[i].token1;
    token2               = value.rows[i].token2;
    
    tokensym1 = getLastPart(token1);
    tokensym2 = getLastPart(token2);
    
    token_contract1      = value.rows[i].token_contract1;
    token_contract2      = value.rows[i].token_contract2;

    token_price1      = value.rows[i].price1;
    token_price2      = value.rows[i].price2;
    
    /*
    global_aprs
    

    */
    console.log("APRS");
   // console.log(global_aprs);
    apr_string = "";
    
    if ( global_aprs != null )
    {
    size2 = global_aprs.rows.length;
    for (var i2=0; i2<size2; i2++)
        {
        // apr_string = global_aprs.rows[0].apr_string;
        tmp_relay_id = global_aprs.rows[i2].relay_id;
        if (tmp_relay_id == pair_id)
           {
           apr_string   = "APR " + global_aprs.rows[i2].apr_string;
           i2 = size2;
           }
        
        } // for i2...
     } // if
     
   /*
    var i2 = thearray[i]['index'];
    
    payout       = value.rows[i2].payout;
    contract     = value.rows[i2].contract;
    description  = value.rows[i2].description;
    noderequired = value.rows[i2].noderequired;
    
     */
 
    buffer += "<div  class='paircell' style=''> " ;
    buffer += "<div    style='height:10px;'></div> " ;

    buffer += "<div  class='paircell_inner' style='text-align:left;'> " ;

       buffer += "<div  class='' style='float:left;width:100px;margin-left:20px;'>" ;
       buffer += "<span style='font-weight:bold;'>"+tokensym1+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+token_contract1+"</span><br>" ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:20px;font-size:30px;border:none'>" ;
       buffer += " / " ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:100px;;border:none'>" ;
       buffer += "<span style='font-weight:bold;'>"+tokensym2+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+token_contract2+"</span><br>" ;
       buffer += "</div> " ;
       
       
        buffer += "<div  class='' style='float:left;width:220px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
       buffer += "Depth<br>";
       buffer +=""+token1+  " /<br>"+token2+" " ;
       buffer += "</div> " ;




       buffer += "<div  class='' style='float:left;width:50px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
       buffer += ""+apr_string+"<br>";
       buffer += "</div> " ;
   
   
   
/*

*/
   buffer += "<div  class='' style='float:left;width:120px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
     buffer += "Price<br>";
     token_price1_view = Number(token_price1).toFixed(4) + " " ;
token_price2_view = Number(token_price2).toFixed(4) + " " ;

buffer += "<span id='price1' style='font-size:12px;' > " +token_price1_view+"  " + tokensym1 +  "</span><br>";
buffer += "<span id='price2' style='font-size:12px;' > " +token_price2_view+"  " + tokensym2 +  "</span><br>";

       buffer += "</div> " ;




   
   
   
       buffer += "<div  class='' style='float:right;width:100px;margin-top:10px;border:none;'>" ;
       buffer += "<span class='swapbutton' onclick='openswap("+pair_id+")'>  SWAP  </span>" ;
       buffer += "</div> " ;


       if ( tokensym1 == "POW" || tokensym2 == "POW" )
          {
          
          

          buffer += "<div  class='' style='float:right;width:50px;margin-top:10px;border:none;' alt='MINE' title='MINE' >" ;
          buffer += "<span class='swapbutton' onclick='openmine("+pair_id+")'> &#9935; </span>" ;
          buffer += "</div> " ;
          }




       buffer += "<div style='clear:both;'></div> " ;
    
    
    
 
  //  buffer += "<span onclick='openswap("+pair_id+")'> [ SWAP ] </span>" ;
    buffer += "</div> " ;
          
    buffer += "<div style='clear:both;'></div> " ;
          
          
    buffer += "</div> " ;
    buffer += "<br> " ;
    } // for i...
 


document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = "";                         
document.getElementById('minediv').innerHTML         = "";
document.getElementById('pairdivs').innerHTML = buffer;
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('swapdiv').innerHTML = "";
document.getElementById('votediv').innerHTML = "";

                         
 

                               
} // callback_render_loadpairs


 
 
 
var swapdirection              = 1;    
var global_pair_id             = 1;   
var global_token1              = "";
var global_token2              = "";
var global_tokensym1           = "";
var global_tokensym2           = "";
var global_token_contract1     = "";
var global_token_contract2     = "";
var global_lptoken             = "";
var global_price1              = "";
var global_price2              = "";
var mininigdialog              = "";

var global_token_contract_mine = "";



function render_swap_area()
{

buffer = "";


/*


*/
buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>SWAP</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";


global_price1_view = Number(global_price1).toFixed(4) + " " ;
global_price2_view = Number(global_price2).toFixed(4) + " " ;

buffer += "<span id='price1' style='font-size:12px;' >1 " + global_tokensym2 +  " => " +global_price1_view+"  " + global_tokensym1 +  "</span><br>";
buffer += "<span id='price2' style='font-size:12px;' >1 " + global_tokensym1 +  " => " +global_price2_view+"  " + global_tokensym2 +  "</span><br>";



//buffer += "token id " + global_pair_id + " " + swapdirection;


if (swapdirection == 1)
{




 
buffer += "<div id='tokenbalance1' style='float:right;'>Balance: ...</div><br>";
buffer += "Payment:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<input id='tokenamount1' type='text' class='tokenamount'  onkeyup='action_keyup_tokenamount1(event)' placeholder='Please enter amount' value=''> <br>";

buffer += "<br>";

 // 
buffer += "<div id='swaparrow' class='swaparrow' onclick='switchswapdir()'>&#8595;</div>";

 
// &#8595; &#8593;  swaparrow
buffer += "<br>";

 
buffer += "<div id='tokenbalance2' style='float:right;'>Balance: ...</div><br>";
//buffer += "Received: (slippage and fees are NOT taken into account here, real payout will be lower!)<br>";
buffer += "Received: (without fees)<br>";
buffer += global_tokensym2+"<br>";
buffer += global_token_contract2+"<br>";
buffer += "<input id='tokenamount2' type='text'  class='tokenamount'   onkeyup='action_keyup_tokenamount2(event)'  placeholder='Please enter amount' value='' > <br>";
 buffer += "<span id='slippage1'></span>";


// buffer += "<hr>";
buffer += "<input id='debug3' type='text'  class='tokenamount'   style='visibility:hidden;width:100%;height:;font-size:12px;'  value='' >";
// buffer += "<hr>";

buffer += "<br>";

buffer += "<br>";




 
buffer += "<div id='swapaction' onclick='swapaction("+global_pair_id+",\""+token_contract1+"\")' class='swapbutton' style='text-align:center;width:100px;' > SWAP </div>";


} // if (swapdirection == 1)




if (swapdirection == 2)
{


 
buffer += "<div id='tokenbalance2' style='float:right;'>Balance: ...</div><br>";
buffer += "Payment:<br>";
buffer += global_tokensym2+"<br>";
buffer += global_token_contract2+"<br>";
buffer += "<input id='tokenamount2' type='text'  class='tokenamount'   onkeyup='action_keyup_tokenamount2(event)' placeholder='Please enter amount' value=''> <br>";

buffer += "<br>";

buffer += "<div id='swaparrow' class='swaparrow' onclick='switchswapdir()'>&#8593;</div>";


buffer += "<br>";

 
buffer += "<div id='tokenbalance1' style='float:right;'>Balance: ...</div><br>";
buffer += "Received: (without fees)<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<input id='tokenamount1' type='text' class='tokenamount'   onkeyup='action_keyup_tokenamount1(event)' placeholder='Please enter amount' value='' > <br>";
 buffer += "<span id='slippage2'></span>";

buffer += "<br>";

// buffer += "<hr>";
buffer += "<input id='debug4' type='text'  class='tokenamount'   style='visibility:hidden;width:100%;height:;font-size:12px;'  value='' >";
// buffer += "<hr>";


buffer += "<div id='swapaction' onclick='swapaction("+global_pair_id+",\""+token_contract1+"\")' class='swapbutton' style='text-align:center;width:100px;' > SWAP </div>";


} // if (swapdirection == 1)

 

buffer += "<div  onclick='manageliquidity(-1)'  class='swapbutton'  style='float:right;margin-right:20px;margin-bottom:10px;text-decoration:none;text-align:center;cursor:pointer;'>";
buffer += "Deposit/Withdraw";
buffer += "</div>";
buffer += "<br>";



buffer += "</div>";
buffer += "<br>";
buffer += "</div>";

 


document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('pairdivs').innerHTML = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('votediv').innerHTML = "";
document.getElementById('createmarketdiv').innerHTML = "";   
document.getElementById('minediv').innerHTML         = "";
mininigdialog = 0;
if (document.getElementById('swapdiv')) document.getElementById('swapdiv').innerHTML  = buffer;

 
get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
 

} // render_swap_area




 
function action_keyup_tokenamount1(e)
{
key = e.keyCode;

valueinput = document.getElementById('tokenamount1').value;
valueoutput = valueinput * global_price2; 

//value = Number(valueoutput).toFixed(4) + " " + global_tokensym2;


fixed2 = getprecision(global_token2);
console.log("xxxxxx");
 console.log("fixed2: ("+global_token2+") " + fixed2);


//value = Number(valueoutput).toFixed(4) + " " ;
value = Number(valueoutput).toFixed(fixed2) + " " ;

document.getElementById('tokenamount2').value  = value;


calc_slippage1();
} // action_keyup_tokenamount1


function action_keyup_tokenamount2(e)
{
key = e.keyCode;

valueinput = document.getElementById('tokenamount2').value;
valueoutput = valueinput * global_price1; 



fixed1 = getprecision(global_token1);
console.log("xxxxxx");
 console.log("fixed1: ("+global_token1+") " + fixed1);

//value = Number(valueoutput).toFixed(4) + " " + global_tokensym1;
value = Number(valueoutput).toFixed(fixed1) + " " ;


document.getElementById('tokenamount1').value  = value;

calc_slippage2();
} // action_keyup_tokenamount2



function calc_slippage1()
{
 


global_token1_val = new Decimal(extractNumbers(global_token1) ); // EOS
global_token2_val = new Decimal(extractNumbers(global_token2) ); // SVX

fixed1 = getprecision(global_token1);
fixed2 = getprecision(global_token2);

valueinput = new Decimal( document.getElementById('tokenamount1').value ); // EOS

output = (global_token2_val.times(
                Decimal.pow(
                  new Decimal(1).minus(
                    valueinput.div(global_token1_val.plus(valueinput))
                  ),
                  global_cw.div(100)
                ).minus(1)
              ).neg());

output = output.toFixed(fixed2);

document.getElementById('debug3').value  = output + " ";
 


  
// Slippage calculation 
pricewithoutslippage = document.getElementById('tokenamount2').value * 1;
slippage1 = new Decimal(100).minus(
                  new Decimal(100).mul( 
                                      new Decimal( output ).div( pricewithoutslippage )
                                      )
                                );
slippage1 = slippage1.toFixed(2);

document.getElementById('slippage1').innerHTML  = "Slippage " + slippage1 + "%";
 
 
// Update real output / tokenamount2
document.getElementById('tokenamount2').value  = output + " ";
 
} // calc_slippage1()

/*
debug4

*/
function calc_slippage2()
{
//console.log("slippage2");





global_token1_val = new Decimal(extractNumbers(global_token1) ); // EOS
global_token2_val = new Decimal(extractNumbers(global_token2) ); // SVX

fixed1 = getprecision(global_token1);
fixed2 = getprecision(global_token2);

//valueinput = new Decimal( document.getElementById('tokenamount1').value ); // EOS
valueinput = new Decimal( document.getElementById('tokenamount2').value ); // SVX

/*
svxForEOSNoFee = (token1.times(
        Decimal.pow(
          new Decimal(1).minus(
            svxAmount.div(token2.plus(svxAmount))
          ),
          Decimal.div(1, cw.div(100))
        ).minus(1)
      ).neg());
*/


output = (global_token1_val.times(
                Decimal.pow(
                  new Decimal(1).minus(
                    valueinput.div(global_token2_val.plus(valueinput))
                  ),
                  global_cw.div(100)
                ).minus(1)
              ).neg());

output = output.toFixed(fixed2);




//output = 42;
document.getElementById('debug4').value  = output + " ";


 


  
// Slippage calculation 
pricewithoutslippage = document.getElementById('tokenamount1').value * 1;
slippage1 = new Decimal(100).minus(
                  new Decimal(100).mul( 
                                      new Decimal( output ).div( pricewithoutslippage )
                                      )
                                );
slippage1 = slippage1.toFixed(2);

document.getElementById('slippage2').innerHTML  = "Slippage " + slippage1 + "%";
 
 
// Update real output / tokenamount2
document.getElementById('tokenamount1').value  = output + " ";
 
  
} // calc_slippage2


function callback_render_loadsinglepair( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";
 

i = 0;



global_pair_id            = value.rows[i].id;
global_cw                 = new Decimal( value.rows[i].cw );
global_total_token1_vol   = value.rows[i].total_token1_vol;
global_total_token2_vol   = value.rows[i].total_token2_vol;
global_token1             = value.rows[i].token1;
global_token2             = value.rows[i].token2;
    
global_tokensym1          = getLastPart(global_token1);
global_tokensym2          = getLastPart(global_token2);
    
global_token_contract1    = value.rows[i].token_contract1;
global_token_contract2    = value.rows[i].token_contract2;

global_lptoken            = value.rows[i].lptoken;
global_price1             = value.rows[i].price1;
global_price2             = value.rows[i].price2;


 
global_total_token1_vol = extractNumbers(global_total_token1_vol);
global_total_token2_vol = extractNumbers(global_total_token2_vol);

 
render_swap_area();
 

} // callback_render_loadsinglepair




/*
balance = value.rows[0].balance;
 
buffer = "" + balance;
last_balance1 = balance;
document.getElementById('balance1').innerHTML = buffer;
                               
} // callback_render_balance1



function getbalancedata()
{
getdata(callback_render_balance1, "eosio.token", global_account, "accounts", "", "", "", 112 );
}

*/

function callback_render_tokenbalance1( value )
{

if (value.rows.length == 0) return;   

balance = value.rows[0].balance;
 
document.getElementById('tokenbalance1').innerHTML = "" + balance;

console.log( value );
} // callback_render_tokenbalance1

function get_token_balance1(token1, token_contract1)
{
getdata(callback_render_tokenbalance1, token_contract1, global_account, "accounts", "", "", "", 112 );

} // get_token_balance1





function callback_render_tokenbalance_lp( value )
{


lptoken          = getLastPart(global_lptoken);
//alert("LP: " + lptoken      );
if (value.rows.length == 0) return;   


size = value.rows.length;

balance = "...";
for (var i=0; i<size; i++)
    {
    sub_balance = value.rows[i].balance;
    
    if ( sub_balance.includes(lptoken) == true )
       {
       balance = sub_balance;
       console.log("FOUND: " + balance);
       i = size;
       } 
    } // for i...




console.log("balances xyz: ("+lptoken+")" );
console.log(value);
 console.log("FIN xyz:" );


if ( document.getElementById('tokenbalance_lp') ) 
   {
   document.getElementById('tokenbalance_lp').innerHTML = "" + balance;
   } else
     {
     console.log("no tokenbalance_lp div!");
     }



 
} // callback_render_tokenbalance_lp



function get_token_balance_lp(token1, token_contract1)
{
 
getdata(callback_render_tokenbalance_lp, "sovdex2trade", global_account, "accounts", "", "", "", 112 );

} // get_token_balance_lp




function callback_render_tokenbalance2( value )
{

if (value.rows.length == 0) return;   

balance = value.rows[0].balance;
 
document.getElementById('tokenbalance2').innerHTML = "" + balance;

console.log( value );
} // callback_render_tokenbalance2

function get_token_balance2(token2, token_contract2)
{
getdata(callback_render_tokenbalance2, token_contract2, global_account, "accounts", "", "", "", 112 );

} // get_token_balance2



function openswap( tokenid )
{
//alert("Token ID " + tokenid); 

// getdata2(callback_readasset_forlist, params, "atomicassets", "sovspacegame", "assets", asset_id, "", "", 1 );

getdata(callback_render_loadsinglepair, "sovdex2trade", "sovdex2trade", "relays", tokenid, "", "", 1 );

/*

*/
} // openswap



 


function callback_render_loadmining( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";

 
i = 0;



global_pair_id            = value.rows[i].id;
global_token1             = value.rows[i].token1;
global_token2             = value.rows[i].token2;
    
global_tokensym1          = getLastPart(global_token1);
global_tokensym2          = getLastPart(global_token2);
    
global_token_contract1    = value.rows[i].token_contract1;
global_token_contract2    = value.rows[i].token_contract2;

global_lptoken            = value.rows[i].lptoken;
global_price1             = value.rows[i].price1;
global_price2             = value.rows[i].price2;


if (global_tokensym1 != "POW") 
   {
   minetoken = global_tokensym1; 
   global_token_contract_mine = global_token_contract1;
   } else
     {
   
     if (global_tokensym2 != "POW") 
        {
        minetoken = global_tokensym2; 
        global_token_contract_mine = global_token_contract2;
        }
     }

// alert( global_pair_id + ' ' + global_tokensym1 + ' ' + global_tokensym2);


 
 

buffer = "";

 
buffer += "<div style='margin-left:5%;text-align:left;'>";
buffer += "<h3>MINE "+minetoken+"  </h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";



 
 
 

  

 
buffer += "<div id='svgsegmentcpu' style='width:10%;margin-bottom:10px;border:none'></div>";  

buffer += 'CPU: <span id="minecpu">...</span><br>';
buffer += minetoken + ' Balance: <span id="minebalance">...</span><br>';

buffer += '<br>';

buffer += 'Mine X:<br>';
buffer += '<input id="minecounter" type="range" min="1" max="100" step="1.0" value="1" oninput="this.nextElementSibling.value = this.value" style="width:90%">';
buffer += ' <output>1</output>';
buffer += '<br>';
buffer += '<br>';

buffer += "<div id='mineaction' onclick='mineaction("+global_pair_id+")' class='swapbutton' style='text-align:center;width:100px;' > MINE </div>";


buffer += "<br>";
buffer += "<br>";
buffer += "<div class='separator' style='width:100%;'>&nbsp;</div>";


// ---

buffer += "<br>";
buffer += "PowerUP<br>";
buffer += "<br>";
 
buffer += "<input type='text' id='eosforpower' value='0.05'> EOS<br>";
buffer += "<br>";
buffer += "<div onclick='powerup(0)' class='swapbutton' style='text-align:center;display:block;width:150px;'>Powerup &#8623;</div><br>";
 
// ---

 
buffer += "</div>";
buffer += "<br>";
buffer += "</div>";

 


document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('pairdivs').innerHTML = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('votediv').innerHTML = "";
document.getElementById('createmarketdiv').innerHTML = "";   
document.getElementById('minediv').innerHTML  = buffer;
mininigdialog = 1;
if (document.getElementById('swapdiv')) document.getElementById('swapdivs').innerHTML = "";


 
 

} // callback_render_loadsinglepair





function drawCircularSegment(angle) {
    const correction = -90;
   
    const radius = 45;  
    const centerX = 50;  
    const centerY = 50;  
    const startAngle = (0+correction) * (Math.PI / 180);    
    const endAngle = (angle+correction) * (Math.PI / 180); 

    const x1 = centerX + radius * Math.cos(startAngle);
    const y1 = centerY + radius * Math.sin(startAngle);
    const x2 = centerX + radius * Math.cos(endAngle);
    const y2 = centerY + radius * Math.sin(endAngle);

    const x_end = centerX + radius * Math.cos(360);
    const y_end = centerY + radius * Math.sin(360);

 
 
                           const svgString = `<svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">

                        <circle cx="${centerX}" cy="${centerY}" r="${radius}" fill="none" stroke="lightgray" stroke-width="1" />
                         <path d="M ${x1},${y1} A ${radius},${radius} 0 ${angle > 180 ? 1 : 0} 1 ${x2},${y2}" fill="none" stroke="#ffffff" stroke-width="8" stroke-linecap="round" />

                        <text x="${centerX}" y="${centerY+5}" text-anchor="middle" alignment-baseline="middle" fill="#ffffff" stroke="#ffffff"  font-size="30">CPU</text>
                       </svg>`;

    return svgString;
} // drawCircularSegment



function openmine( tokenid )
{

getdata(callback_render_loadmining, "sovdex2trade", "sovdex2trade", "relays", tokenid, "", "", 1 );

} // openmine( tokenid )




function mineaction( pair_id )
{ 

minecounter = document.getElementById('minecounter').value;

/*
cpuminingsvx

action: mine(User, Relay)
*/ 
// alert('pairid: '+pair_id+' minecounter' + minecounter);



var theactions = [];

for (var i=0; i<minecounter; i++)
    {
    
    
    var action = {
                 account: 'cpuminingsvx',
                 name: 'mine',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "relay_id": pair_id
                                              
                       }
                 };
 
    theactions.push(action);
    
    
    
    } // for i...


if (1)
   {
   transact( func_success, func_error, theactions );
   }   
   
 
} // mineaction


 
 
function readpairs()
{
//alert('read pairs');

getdata(callback_render_loadpairs, "sovdex2trade", "sovdex2trade", "relays", "", "", "", 4000 );

//document.getElementById('pairdivs').innerHTML = "abc";
  
//pairdivs

} // readpairs



function createpair()
{

//alert("Create... soon");

buffer = "";
 


buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Create Market</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";


/*

initrelay():
user: sovplsgomoon
token1: 25.0000 EOS
token_contract1: eosio.token
token2: 20000.0000 SOV
token_contract2: sovmintofeos
lpsym: SOVEOS
cw: 100
fee: 40

cm_token1
cm_token_contract1
cm_token2
cm_token_contract2
cm_lpsym
cm_cw 100
cm_fee 50
*/



buffer += "token1:<br>";
buffer += "<input id='cm_token1' type='text'  class='tokenamount'     placeholder='1.0000 EOS' value='' > <br>";
buffer += "token_contract1:<br>";

buffer += "<input id='cm_token_contract1' type='text'  class='tokenamount'     placeholder='' value='' > <br>";

buffer += "<br>";
buffer += "<br>";



buffer += "token2:<br>";
buffer += "<input id='cm_token2' type='text'  class='tokenamount'     placeholder='1.0000 EOS' value='' > <br>";

buffer += "token_contract2:<br>";
buffer += "<input id='cm_token_contract2' type='text'  class='tokenamount'     placeholder='' value='' > <br>";

buffer += "lpsym:<br>";
buffer += "<input id='cm_lpsym' type='text'  class='tokenamount'     placeholder='' value='' > <br>";

buffer += "cw:<br>";
buffer += "<input id='cm_cw' type='text'  class='tokenamount'     placeholder='' value='100' > <br>";

buffer += "fee:<br>";
buffer += "<input id='cm_fee' type='text'  class='tokenamount'     placeholder='' value='40' > <br>";



buffer += "<br>";
buffer += "<br>";




 
buffer += "<div id='cm_action' onclick='createmarketaction()' class='swapbutton' style='text-align:center;width:200px;' > Create Market </div>";





buffer += "<br>";
buffer += "</div>";
buffer += "</div>";

//buffer += "token id " + global_pair_id + " " + swapdirection;




document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = buffer;
document.getElementById('minediv').innerHTML         = "";
mininigdialog = 0;
if (document.getElementById('swapdiv'))  document.getElementById('swapdiv').innerHTML = "";
document.getElementById('pairdivs').innerHTML        = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('votediv').innerHTML = "";
 


}





function showpools()
{
//alert("soon");

buffer = "";
// 

buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Pools</h3>";
buffer += "</div>";

  buffer += "<div  class='' style='float:left;margin-left:5%; ;margin-top:10px;border:none;' alt='CLAIM' title='CLAIM' >" ;
          buffer += "<span class='swapbutton' onclick='claimaction()'> CLAIM REWARDS </span>" ;
          buffer += "</div> " ;
          

   
 
        
 buffer += "<div id='rewardinfo' style='text-align:left;margin-left:5%;'> " ;
 buffer += "" ;          
 buffer += "</div> " ; // rewardinfo          




 buffer += "<br><br>";
 buffer += "<br> ";
    
    size2 = global_aprs.rows.length;
    for (var i2=0; i2<size2; i2++)
        {
        apr_string       = global_aprs.rows[i2].apr_string;
        tmp_relay_id     = global_aprs.rows[i2].relay_id;
        tmp_equiv_tvl    = global_aprs.rows[i2].equiv_tvl;
        tmp_daily_reward = global_aprs.rows[i2].daily_reward;
        tmp_extra_info   = global_aprs.rows[i2].extra_info;
        
        // global_pairs
        
        tmp_token1          = "";
        tmp_token2          = "";
        tmp_tokensym1       = "";
        tmp_tokensym2       = "";
        tmp_token_contract1 = "";
        tmp_token_contract2 = "";
    
        size3 = global_pairs.rows.length;
        var index = -1;
        for (var i3=0; i3<size3; i3++)
            {
            // apr_string = global_aprs.rows[0].apr_string;
            
          
            tmp_relay_id2 = global_pairs.rows[i3].id;
            if (tmp_relay_id == tmp_relay_id2)
               {
               tmp_token1   = global_pairs.rows[i3].token1;
               tmp_token2   = global_pairs.rows[i3].token2;
               
               tmp_tokensym1 = getLastPart(tmp_token1);
               tmp_tokensym2 = getLastPart(tmp_token2);

               tmp_token_contract1      = global_pairs.rows[i3].token_contract1;
               tmp_token_contract2      = global_pairs.rows[i3].token_contract2;

               i3 = size3;
               }
        
        
            } // for i3...
            
            /*
             pair_id              = value.rows[i].id;
    token1               = value.rows[i].token1;
    token2               = value.rows[i].token2;
    
    tokensym1 = getLastPart(token1);
    tokensym2 = getLastPart(token2);
    
    token_contract1      = value.rows[i].token_contract1;
    token_contract2      = value.rows[i].token_contract2;

    token_price1      = value.rows[i].price1;
    token_price2      = value.rows[i].price2;
            */
        
        /*
        if (tmp_relay_id == pair_id)
           {
           apr_string   = global_aprs.rows[i2].apr_string;
           i2 = size2;
           }
        */
        
         buffer += "<div  class='paircell' style=''> " ;
    buffer += "<div    style='height:10px;'></div> " ;

    buffer += "<div  class='paircell_inner' style='text-align:left;'> " ;

       buffer += "<div  class='' style='float:left;width:100px;margin-left:20px;'>" ;
       buffer += "<span style='font-weight:bold;'>"+tmp_tokensym1+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+tmp_token_contract1+"</span><br>" ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:20px;font-size:30px;border:none'>" ;
       buffer += " / " ;
       buffer += "</div> " ;


       buffer += "<div  class='' style='float:left;width:100px;;border:none'>" ;
       buffer += "<span style='font-weight:bold;'>"+tmp_tokensym2+"</span><br>" ;
       buffer += "<span style='font-size:12px'>"+tmp_token_contract2+"</span><br>" ;
       buffer += "</div> " ;
       
       /*
        buffer += "<div  class='' style='float:left;width:220px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
       buffer += "Depth...<br>";
       //buffer +=""+token1+  " /<br>"+token2+" " ;
       buffer += "</div> " ;
*/



       buffer += "<div  class='' style='float:left;width:50px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
       buffer += "APR "+apr_string+"<br>";
       buffer += "</div> " ;
   
   
   
   
   buffer += "<div  onclick='manageliquidityload("+tmp_relay_id+")'  class='swapbutton'  style='float:right;margin-right:20px;text-align:center;text-decoration:none;cursor:pointer;'>";
buffer += "Deposit/Withdraw";
buffer += "</div>";

      buffer += "<div  onclick='depositreward("+tmp_relay_id+")'  class='swapbutton'  style='float:right;margin-right:20px;text-align:center;text-decoration:none;cursor:pointer;'>";
buffer += "Create Rewards<br><small style='font-size:10px;'>(Pool Manager)</small>";
buffer += "</div>";

// alfalf
      buffer += "<div  onclick='initunvoteload("+tmp_relay_id+")'  class='swapbutton'  style='float:right;margin-right:20px;text-align:center;text-decoration:none;cursor:pointer;'>";
buffer += "Unvote<br><small style='font-size:10px;'> </small>";
buffer += "</div>";
      buffer += "<div  onclick='initvoteload("+tmp_relay_id+")'  class='swapbutton'  style='float:right;margin-right:20px;text-align:center;text-decoration:none;cursor:pointer;'>";
buffer += "Vote<br><small style='font-size:10px;'> </small>";
buffer += "</div>";

   
/*


   buffer += "<div  class='' style='float:left;width:120px;margin-left:30px;font-size:12px;text-align:left;;border:none;'>" ;
     buffer += "Price<br>";
     token_price1_view = Number(token_price1).toFixed(4) + " " ;
token_price2_view = Number(token_price2).toFixed(4) + " " ;

buffer += "<span id='price1' style='font-size:12px;' > " +token_price1_view+"  " + tokensym1 +  "</span><br>";
buffer += "<span id='price2' style='font-size:12px;' > " +token_price2_view+"  " + tokensym2 +  "</span><br>";

       buffer += "</div> " ;
*/



   
   
   /*
       buffer += "<div  class='' style='float:right;width:100px;margin-top:10px;border:none;'>" ;
       buffer += "Relay ID: " + tmp_relay_id;
       buffer += "</div> " ;
*/

            
        
        
 



       buffer += "<div style='clear:both;'></div> " ;
    
    
    
 
  //  buffer += "<span onclick='openswap("+pair_id+")'> [ SWAP ] </span>" ;
    buffer += "</div> " ;
          
    buffer += "<div style='clear:both;'></div> " ;
          
          
    buffer += "</div> " ;
    buffer += "<br> " ;
    
        } // for i2...





document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = "";
document.getElementById('minediv').innerHTML         = "";
mininigdialog = 0;
if (document.getElementById('swapdiv'))  document.getElementById('swapdiv').innerHTML = "";
document.getElementById('pairdivs').innerHTML        = "";
document.getElementById('pooldivs').innerHTML        = buffer;
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('votediv').innerHTML = "";



load_reward_info();
} // showpools()






function callback_render_rewardinfo( value )
{
  
console.log(value);
  
if (value.rows.length == 0) return;   


buffer = "<div style='clear:both'></div><br>";
 


size = value.rows.length;

/*
id
: 
0
token_contract
: 
"eosio.token"
value
: 
"1.3516 EOS"
*/
for (var i=0; i<size; i++)
    {
    token_contract            = value.rows[i].token_contract
    the_value                 = value.rows[i].value
    buffer +=  the_value + " ("+token_contract+") <br>";
    } // for i...

//global_pair_id            = value.rows[i].id;

 
document.getElementById('rewardinfo').innerHTML       = buffer;
} // callback_render_rewardinfo

function load_reward_info()
{


 global_account2 = global_account;
  
getdata(callback_render_rewardinfo, "sovdex2trade", global_account2, "claimrewards", "", "", "", 4000 );


} // load_reward_info



function showfarms()
{
alert("soon");
} // showfarms


function claimaction()
{
// 
//alert("test");



var theactions = [];




memo = "";


 
 
    var action = {
                 account: "sovdex2trade",
                 name: 'claimreward',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + ""        
                       }
                 };
 
 
    theactions.push(action);
    
    
    
         
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   
} // claimaction()




function createmarketaction()
{
// 
cm_token1 = document.getElementById('cm_token1').value;
cm_token_contract1 = document.getElementById('cm_token_contract1').value;
cm_token2 = document.getElementById('cm_token2').value;
cm_token_contract2 = document.getElementById('cm_token_contract2').value;

cm_lpsym = document.getElementById('cm_lpsym').value;
cm_cw = document.getElementById('cm_cw').value;
cm_fee = document.getElementById('cm_fee').value;

//alert("C M: " + cm_token1);

//return(0);




var theactions = [];




memo = "";



 
    var action = {
                 account: cm_token_contract1,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : cm_token1,
                       "memo": memo
                       }
                 };
 
    theactions.push(action);
    
    
   

 
    var action = {
                 account: cm_token_contract2,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : cm_token2,
                       "memo": memo
                       }
                 };
 
    theactions.push(action);
       
    
    
/*

cm_token1
cm_token_contract1
cm_token2
cm_token_contract2
cm_lpsym
cm_cw 100
cm_fee 50
*/
 
    var action = {
                 account: "sovdex2trade",
                 name: 'initrelay',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "token1": cm_token1,
                       "token_contract1": cm_token_contract1,
                       "token2": cm_token2,
                       "token_contract2": cm_token_contract2,
                       "lpsym": cm_lpsym + "",
                       "cw": cm_cw,
                       "fee": cm_fee                         
                       }
                 };
 
 
    theactions.push(action);
    
    
    
         
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   

} // createmarketaction

function swapaction( pair_id, token_contract1)
{

// swapdirection

tokenamount1 = document.getElementById('tokenamount1').value; 
tokenamount2 = document.getElementById('tokenamount2').value; 


// swapaction 
//alert("global_token1: " + global_token1 + " "  + global_token2);

fixed1 = getprecision(global_token1);
fixed2 = getprecision(global_token2);

 
console.log(tokenamount1 + ' ' + fixed1 + ' ' + tokenamount2 + ' ' + fixed2 + " " );

tokenamount1 = Number(tokenamount1).toFixed(fixed1) + " " + global_tokensym1;   
tokenamount2 = Number(tokenamount2).toFixed(fixed2) + " " + global_tokensym2;   


//alert( pair_id  + ' ' + tokenamount1 + ' ' + token_contract1 + ' ' + global_account );



var theactions = [];


if (swapdirection == 1)
{

memo = "";




    
    
    
   
    var action = {
                 account: global_token_contract1,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount1,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    memo = "";
    

   
    var action = {
                 account: "sovdex2trade",
                 name: 'swap',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "swapasset": tokenamount1,
                       "relay_id": pair_id,
                       "receiver": global_account + "",
                       "intermediate": false,
                       "expected": tokenamount2,
//                       "tolerance": 5000 
                       "tolerance": -1,
                       "memo": memo 
                       }
                 };

 
    theactions.push(action);
    
    
    
        
    
    console.log("----- " + global_account);
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   
   
} // if (swapdirection == 1)


   
   


if (swapdirection == 2)
{

memo = "";



//alert(" Other dir ");
    
  
    
   
    var action = {
                 account: global_token_contract2,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount2,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    
    memo = "xyz";

   
    var action = {
                 account: "sovdex2trade",
                 name: 'swap',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "swapasset": tokenamount2,
                       "relay_id": pair_id,
                       "receiver": global_account + "",
                       "intermediate": false,
                       "expected": tokenamount1,
//                       "tolerance": 5000 
                       "tolerance": -1,
                       "memo": memo 
                       }
                 };

 
    theactions.push(action);
    
    
    
        
    
    console.log("----- " + global_account);
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
 
   
} // if (swapdirection == 1)

   
 
} // swapaction


function switchswapdir( dir )
{
//alert(dir);

// &#8595; &#8593;  swaparrow

if (swapdirection == 1) 
   {
   swapdirection = 2;    
   }
   else
      {
      swapdirection = 1;
      }


render_swap_area();

} // switchswapdir






function dopositrewardaction( pairid )
{



tokenamount1           = document.getElementById('tokenamount1_reward').value; 
tokenamount1_contract  = document.getElementById('tokenamount1_contract').value; 
loading_ratio          = document.getElementById('loading_ratio').value; 


fixed_load          = document.getElementById('fixed_load').checked; 
//alert(fixed_load);

 //exit(0);

tmp_tokensym1          = getLastPart(tokenamount1);

 
//tokenamount2 = document.getElementById('tokenamount2').value; 
// tokenamount1_contract

 
fixed1 = getprecision(tokenamount1);
//fixed2 = getprecision(global_token2);
 
//console.log(tokenamount1 + ' ' + fixed1 + ' ' + tokenamount2 + ' ' + fixed2 + " " );

//tokenamount1 = Number(tokenamount1).toFixed(fixed1) + " " + tmp_tokensym1;   
//tokenamount2 = Number(tokenamount2).toFixed(fixed2) + " " + global_tokensym2;   

 
  
var theactions = [];

 
memo = "";




    
    
   
   
    var action = {
                 account: tokenamount1_contract,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount1,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    
   

   
    var action = {
                 account: "sovdex2trade",
                 name: 'openreward',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "contributor": global_account + "",                       
                       "reward": tokenamount1,
                       "reward_contract": tokenamount1_contract,                       
                       "relay_id": pairid,
                       
                       "loading_ratio": loading_ratio + "",
                       "fixed_load": fixed_load
                       }
                 };

 
    theactions.push(action);
    
  
    
        
    
    console.log("----- " + global_account);
    console.log(theactions);
    
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   

} // dopositrewardaction




function depositreward( pairid ) 
{
//alert("Open reward! " + pairid);



buffer = "";
 
 




buffer += "<div style='margin-left:5%;text-align:left;'>";
buffer += "<h3>Add Rewards (Experts/Pool Managers)</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";



 
buffer += "Amount: (any Token is allowed, make sure to add correct precision!)<br>";
buffer += "<input id='tokenamount1_reward' type='text' class='tokenamount'  onkeyup='' placeholder='42.0000 TOK' value=''> <br>";

buffer += "<br>";
buffer += "Token Contract:<br>";
buffer += "<input id='tokenamount1_contract' type='text' class='tokenamount'  onkeyup='' placeholder='tokentoken11' value=''> <br>";


buffer += "<br>";
buffer += "Reward per Day: (100 = 1% per day)<br>";
buffer += "<input id='loading_ratio' type='text' class='tokenamount'  onkeyup='' placeholder='' value='100'> <br>";


buffer += "<br>";
buffer += "Linear distribution<br>";
buffer += "<input id='fixed_load' type='checkbox'  value='1' checked='checked' > <br>";




buffer += "<br>";
buffer += "<br>";




 
buffer += "<div id='' onclick='dopositrewardaction("+pairid+")' class='swapbutton' style='text-align:center;width:200px;' > Add Liquidity </div>";


buffer += "<br>";
buffer += "<br>";

/*
then openreward
     fixed load = true => linear
     loading_ratio = 100 = 1% per day
*/

 buffer += "<br>";

buffer += "</div>";
buffer += "</div>";

//buffer += "token id " + global_pair_id + " " + swapdirection;



document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = "";
document.getElementById('minediv').innerHTML         = "";
mininigdialog = 0;
if (document.getElementById('swapdiv'))  document.getElementById('swapdiv').innerHTML = "";
document.getElementById('pairdivs').innerHTML        = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = buffer;
document.getElementById('votediv').innerHTML = "";

} // depositreward


function callback_render_manageliquidity( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";
 

i = 0;



global_pair_id            = value.rows[i].id;
global_token1             = value.rows[i].token1;
global_token2             = value.rows[i].token2;
    
global_tokensym1          = getLastPart(global_token1);
global_tokensym2          = getLastPart(global_token2);
    
global_token_contract1    = value.rows[i].token_contract1;
global_token_contract2    = value.rows[i].token_contract2;

global_lptoken            = value.rows[i].lptoken;
global_price1             = value.rows[i].price1;
global_price2             = value.rows[i].price2;

 
//render_swap_area();
 
 
manageliquidity(-1);

} // callback_render_manageliquidity



 
function manageliquidityload( tokenid )
{


getdata(callback_render_manageliquidity, "sovdex2trade", "sovdex2trade", "relays", tokenid, "", "", 1 );


//alert("Load " + manageliquidity);
} // 


// commendt: manageliquidity unused?
function manageliquidity( manageliquidity )
{
//alert("Manage... soon");

// ... manageliquidity

get_token_balance1(global_token1, global_token_contract1);
get_token_balance2(global_token2, global_token_contract2);
 
 
 
buffer = "";
 


buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Manage Liquidity</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";


buffer += "<strong>Add Liquidity</strong><br>"; 
buffer += "Total LP-Token balance: "+global_lptoken+"<br>"; 




//buffer += "<div id='tokenbalance1' style='float:right;'>Balance: xxx</div><br>";
buffer += "Token1:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<input id='tokenamount1' type='text' class='tokenamount'  onkeyup='action_keyup_tokenamount1(event)' placeholder='Please enter amount' value=''> <br>";

buffer += "<br>";

 // 
//buffer += "<div id='swaparrow' class='swaparrow' onclick='switchswapdir()'>&#8595;</div>";

 
// &#8595; &#8593;  swaparrow
buffer += "<br>";

 
//buffer += "<div id='tokenbalance2' style='float:right;'>Balance: yyy</div><br>";
buffer += "Token2:<br>";
buffer += global_tokensym2+"<br>";
buffer += global_token_contract2+"<br>";
buffer += "<input id='tokenamount2' type='text'  class='tokenamount'   onkeyup='action_keyup_tokenamount2(event)'  placeholder='Please enter amount' value='' > <br>";

buffer += "<br>";




 
buffer += "<div id='swapaction' onclick='addliquidityaction("+global_pair_id+",\""+token_contract1+"\")' class='swapbutton' style='text-align:center;width:200px;' > Add Liquidity </div>";


buffer += "<br>";
buffer += "<br>";




buffer += "<div class='separator'>&nbsp;</div>";

 buffer += "<h3>My Liquidity</h3>";

 

buffer += "LP-Balance: <span id='tokenbalance_lp' style=''>...</span><br>";


buffer += "<br>";
buffer += "<br>";


/*
buffer += '<input id="liquidrembar" type="range" min="25" max="100" step="25.0" value="50" oninput="this.nextElementSibling.value = this.value" style="width:90%">';
buffer += ' <output>1</output>';
buffer += '<br>';
*/


buffer += "<strong>Remove Liquidity</strong><br><br>";

buffer += "<div id='swapaction' onclick='removeliquidityaction("+global_pair_id+",\""+token_contract1+"\",25)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > 25% </div>";
buffer += "<div id='swapaction' onclick='removeliquidityaction("+global_pair_id+",\""+token_contract1+"\",50)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > 50% </div>";
buffer += "<div id='swapaction' onclick='removeliquidityaction("+global_pair_id+",\""+token_contract1+"\",75)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > 75% </div>";
buffer += "<div id='swapaction' onclick='removeliquidityaction("+global_pair_id+",\""+token_contract1+"\",100)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > 100% </div>";
buffer += "<div style='clear:both'></div>";


buffer += "<br>";
buffer += "<br>";


buffer += "</div>";
buffer += "</div>";

//buffer += "token id " + global_pair_id + " " + swapdirection;




document.getElementById('liquiditydiv').innerHTML    = buffer;
document.getElementById('createmarketdiv').innerHTML = "";
document.getElementById('minediv').innerHTML         = "";
mininigdialog = 0;
if (document.getElementById('swapdiv')) document.getElementById('swapdiv').innerHTML         = "";
document.getElementById('pairdivs').innerHTML        = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('votediv').innerHTML = "";

 


// global_lptoken

lptoken          = getLastPart(global_lptoken);
 
get_token_balance_lp(lptoken, "sovdex2trade");
 
//liquiditydiv

} // manageliquidity






function addliquidityaction( pair_id, token_contract1 )
{
// swapaction
 

 

tokenamount1 = document.getElementById('tokenamount1').value; 
tokenamount2 = document.getElementById('tokenamount2').value; 


 
fixed1 = getprecision(global_token1);
fixed2 = getprecision(global_token2);

 
console.log(tokenamount1 + ' ' + fixed1 + ' ' + tokenamount2 + ' ' + fixed2 + " " );

tokenamount1 = Number(tokenamount1).toFixed(fixed1) + " " + global_tokensym1;   
tokenamount2 = Number(tokenamount2).toFixed(fixed2) + " " + global_tokensym2;   


 //alert( pair_id  + ' ' + tokenamount1 + ' ' + token_contract1 + ' ' + global_account );



var theactions = [];


 
memo = "";




    

    
   
    var action = {
                 account: global_token_contract1,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount1,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    
    

   
   
    var action = {
                 account: global_token_contract2,
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                       "quantity" : tokenamount2,
                       "memo": memo
                       }
                 };

 

 
    theactions.push(action);
    
    

         

    var action = {
                 account: "sovdex2trade",
                 name: 'depositlp',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",
                       "token1": tokenamount1,
                       "token2": tokenamount2,
                       "relay_id": pair_id       
                       }
                 };
 
 
    theactions.push(action);
    
    
             
    
    console.log("----- " + global_account);
    console.log(theactions);
    
    
     
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   
   
 

} // addliquidityaction



function removeliquidityaction( pair_id, token_contract1, percent )
{


//tokenbalance_lp
tokenbalance_lp = document.getElementById('tokenbalance_lp').innerHTML; 

tmp_tokensym1 = getLastPart(tokenbalance_lp);
tokenbalance_lp_tmp = extractNumbers(tokenbalance_lp);

// alert("Remove tokenbalance_lp:" + tokenbalance_lp + " - " + percent + ' - ' + (100/percent) );
 
console.log("tokenbalance_lp: " + tokenbalance_lp);

tokenbalance_lp_tmp =  Math.floor(  tokenbalance_lp_tmp * (percent/100)  ); 


tokenbalance_lp_tmp = tokenbalance_lp_tmp + " " +  tmp_tokensym1;

// alert("Remove " + percent + ' -::: ' +  tokenbalance_lp + " (" +(percent/100)+ ") ["+tokenbalance_lp_tmp+"]");

var theactions = [];


 
memo = "";




    

    
   
    var action = {
                 account: "sovdex2trade",
                 name: 'transfer',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "from": global_account + "",
                       "to": "sovdex2trade",
                   //    "quantity" : tokenbalance_lp,
                       "quantity" : tokenbalance_lp_tmp,
                       "memo": memo
                       }
                 };

 
    theactions.push(action);
    
    
    
    /*
    2) withdrawlp lptoken:20600 SVXEOS
              user: goldstandard
    */
    
    
    var action = {
                 account: "sovdex2trade",
                 name: 'withdrawlp',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "lptoken" : tokenbalance_lp_tmp,
                       "user": global_account + ""
                       }
                 };

 
    theactions.push(action);
    
    
     
             
    
    console.log("----- " + global_account);
    console.log(theactions);
    
    
     
 
if (1)
   {
   transact( func_success, func_error, theactions );
   }    
   
   


} // removeliquidityaction




var svx_power_staked = 0;

function callback_render_initvote( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";
 

i = 0;


 
global_pair_id            = value.rows[i].relay_id;
svx_power_staked = value.rows[i].svx_power_staked;
 
//render_swap_area();
 // svx_power_staked
 
votepool(global_pair_id);

 

} // callback_render_initvote



function initvoteload( pair_id )
{
//alert(" votepool pair_id xxx: " + pair_id );


//getdata(callback_render_initvote, "sovdex2trade", "sovdex2trade", "relays", pair_id, "", "", 1 );
getdata(callback_render_initvote, "sovdexlpvote", global_account, "userstakes", pair_id, "", "", 1 );


//votepool(pair_id);
}






function callback_render_initunvote( value )
{

if (value.rows.length == 0) return;   

console.log( value );

buffer = "";
 

i = 0;


 
global_pair_id            = value.rows[i].relay_id;
svx_power_staked = value.rows[i].svx_power_staked;
 
//render_swap_area();
 // svx_power_staked
 
//votepool(global_pair_id);
// alfalfalf
 unvotepool(global_pair_id);

} // callback_render_initvote



function initunvoteload( pair_id )
{
//alert(" votepool pair_id xxx: " + pair_id );


//getdata(callback_render_initvote, "sovdex2trade", "sovdex2trade", "relays", pair_id, "", "", 1 );
getdata(callback_render_initunvote, "sovdexlpvote", global_account, "userstakes", pair_id, "", "", 1 );


//votepool(pair_id);
}



function votepool( pair_id )
{
//alert(" votepool pair_id: " + pair_id );

 


buffer = "";
 


buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Vote</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";


buffer += "<strong>Voting</strong><br>"; 
//buffer += "Total LP-Token balance: "+global_lptoken+"<br>"; 
buffer += "SVX Power Staked: "+svx_power_staked+"<br>"; 




//buffer += "<div id='tokenbalance1' style='float:right;'>Balance: xxx</div><br>";
//buffer += "Token1:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<br>";
buffer += "<input id='tokenamount1_vote' type='text' class='tokenamount' style='width:50%'  onkeyup='action_keyup_tokenamount1(event)' placeholder='Please enter SVX amount' value=''> <br>";

buffer += "<br>";

 
//buffer += "<div id='voteaction' onclick='voteaction("+global_pair_id+",\""+token_contract1+"\",25)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > Vote </div>";
buffer += "<div id='voteaction' onclick='voteaction("+pair_id+")' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > Vote </div>";
 

buffer += "<br>";
buffer += "<br>";
buffer += "<span style='font-size:8px;float:right;'>Pair-ID: "+pair_id+"</span><br>";


buffer += "</div>";
buffer += "</div>";

//buffer += "token id " + global_pair_id + " " + swapdirection;




document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = "";                         
document.getElementById('minediv').innerHTML         = "";
document.getElementById('pairdivs').innerHTML = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('swapdiv').innerHTML = "";
document.getElementById('votediv').innerHTML = buffer;

} // votepool


//alfalf

function voteaction( pair_id )
{
tokenamount1_vote = document.getElementById('tokenamount1_vote').value;

tokenamount1_vote = Number(tokenamount1_vote).toFixed(4) + " SVX" ;

 

//alert("vote pairx : " + pair_id+ ' tokenamount1_vote:' + tokenamount1_vote );
 

var theactions = [];


 
memo = "";




    
    
    var action = {
                 account: "sovdexlpvote",
                 name: 'vote',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",

                       "svx" : tokenamount1_vote,
                       "relay_id": pair_id + ""
                       }
                 };

 
    theactions.push(action);
    
    
     
             
    
    console.log("----- " + global_account);
    console.log(theactions);
    
    
     
 
if (1)
   {
   //transact( func_success, func_error, theactions );
   transact( func_success_vote, func_error, theactions );
   
   }    
   
   
} // voteaction



function unvoteaction( pair_id )
{
tokenamount1_unvote = document.getElementById('tokenamount1_unvote').value;

tokenamount1_unvote = Number(tokenamount1_unvote).toFixed(4) + " SVX" ;

 

//alert("vote pairx : " + pair_id+ ' tokenamount1_unvote:' + tokenamount1_unvote );
 

var theactions = [];


 
memo = "";




    
    
    var action = {
                 account: "sovdexlpvote",
                 name: 'unvote',
                 authorization: [{
                                actor: global_account + "",
                                permission: "active"
                                }],
                 data: {
                       "user": global_account + "",

                       "svx" : tokenamount1_unvote,
                       "relay_id": pair_id + ""
                       }
                 };

 
    theactions.push(action);
    
    
     
             
    
    console.log("----- " + global_account);
    console.log(theactions);
    
    
     
 
if (1)
   {
  // transact( func_success, func_error, theactions );
   transact( func_success_unvote, func_error, theactions );
   
   }    
   
   
} // unvoteaction


function unvotepool( pair_id )
{
//alert("unvotepool pair_id y:  " + pair_id );



buffer = "";
 


buffer += "<div style='margin-left:5%;text-align:left;'>";
 buffer += "<h3>Unvote</h3>";
buffer += "</div>";



buffer += "<div class='swapwnd' style=''>";
buffer += "<br>";
buffer += "<div class='swapwnd_inner' style='text-align:left;'>";


buffer += "<strong>Voting</strong><br>"; 
//buffer += "Total LP-Token balance: "+global_lptoken+"<br>"; 
buffer += "SVX Power Staked: "+svx_power_staked+"<br>"; 




//buffer += "<div id='tokenbalance1' style='float:right;'>Balance: xxx</div><br>";
//buffer += "Token1:<br>";
buffer += global_tokensym1+"<br>";
buffer += global_token_contract1+"<br>";
buffer += "<br>";
buffer += "<input id='tokenamount1_unvote' type='text' class='tokenamount' style='width:50%'  onkeyup='action_keyup_tokenamount1(event)' placeholder='Please enter SVX amount' value=''> <br>";

buffer += "<br>";

 
//buffer += "<div id='voteaction' onclick='voteaction("+global_pair_id+",\""+token_contract1+"\",25)' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > Vote </div>";
buffer += "<div id='voteaction' onclick='unvoteaction("+pair_id+")' class='swapbutton' style='text-align:center;width:100px;float:left;margin-right:10px;' > Unvote </div>";
 

buffer += "<br>";
buffer += "<br>";
buffer += "<span style='font-size:8px;float:right;'>Pair-ID: "+pair_id+"</span><br>";


buffer += "</div>";
buffer += "</div>";

//buffer += "token id " + global_pair_id + " " + swapdirection;




document.getElementById('liquiditydiv').innerHTML    = "";
document.getElementById('createmarketdiv').innerHTML = "";                         
document.getElementById('minediv').innerHTML         = "";
document.getElementById('pairdivs').innerHTML = "";
document.getElementById('pooldivs').innerHTML        = "";
document.getElementById('rewarddiv').innerHTML       = "";
document.getElementById('swapdiv').innerHTML = "";
document.getElementById('votediv').innerHTML = buffer;


} // unvotepool


function extractNumbers(str) {
    // Remove all non-numeric characters except dot (.)
    const cleanedString = str.replace(/[^0-9.]/g, '');
    
    // Convert the cleaned string to a floating point number
    const number = parseFloat(cleanedString);
    
    // Return the floating point number
    return number;
}


var global_aprs = null;

function callback_render_read_aprs( value )
{

console.log(value);

 
if (value.rows.length == 0) return;                   

global_aprs = value;

//alert("test2");
/*
balance = value.rows[0].balance;
 
 
if (balance != undefined)
   {
   document.getElementById('minebalance').innerHTML = balance + "";
   }
  */
 
} // callback_render_minigbalance


function read_aprs()
{


 
//getdata(callback_render_read_aprs, "sovdex2trade", global_account, "accounts", "", "", "", 112 );
getdata(callback_render_read_aprs, "sovdex2trade", "sovdex2trade", "aprs", "", "", "", 1112 );
 
} // read_aprs()



function getprecision( string ) {
 
    const parts = string.split(' ');


    if (parts.length !== 2 || isNaN(parseFloat(parts[0]))) {
        return -1;
    }

    const number = parts[0];
    const currency = parts[1];

    const decimalPointIndex = number.indexOf('.');

    if (decimalPointIndex === -1) {
        return 0;
    }

    return number.length - decimalPointIndex - 1;
}

readpairs();
read_aprs();

</script>


<script>
init_wallets( "sovpowerpack",setaccountname, logoutall );

update_thread(); 
</script>

</body>
</hmtl>